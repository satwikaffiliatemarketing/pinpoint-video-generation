name: Daily Pinpoint Video

on:
  schedule:
    # Runs at 18:32 UTC daily (00:02 IST)
    - cron: '32 18 * * *'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  build-and-run:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          pip install -r requirements.txt
          playwright install chromium

      - name: Run Animation & Upload
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          YOUTUBE_CLIENT_ID: ${{ secrets.YOUTUBE_CLIENT_ID }}
          YOUTUBE_CLIENT_SECRET: ${{ secrets.YOUTUBE_CLIENT_SECRET }}
          YOUTUBE_REFRESH_TOKEN: ${{ secrets.YOUTUBE_REFRESH_TOKEN }}
        run: |
          # Xvfb is needed for running Playwright in some environments if not purely headless,
          # but we use headless=False logic in code.
          # GitHub Actions headless runners usually support xvfb.
          # We'll use pyvirtualdisplay or xvfb-run if needed, but playwright works well with headless.
          # Wait, our code has headless=False to ensure recording works best? 
          # Actually, Playwright video recording works in headless mode too. 
          # But let's install deps for system.
          sudo apt-get install -y xvfb
          xvfb-run --auto-servernum --server-args="-screen 0 1920x1080x24" python main.py
